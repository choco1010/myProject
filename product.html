<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise</title>
    <link rel="icon" href="./public/iconimage/flowerlogo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="public/font-awesome/6.4.2/css/all.css">
    <link rel="stylesheet" href="public/font-awesome/6.4.2/css/v4-shims.css"> 
    <link rel="stylesheet" href="css/swiper.css">  
    <link rel="stylesheet" href="css/product.css">
    <link rel="stylesheet" href="css/shared.css">
    <link href="./public/toastr/toastr.css" rel="stylesheet"/>
    <script src="./js/jquery-3.7.1.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="./js/swiper.js"></script>
    <script src="./public/toastr/toastr.js"></script>
    <script src="./js/cartslidbar.js"></script>
    <script src="./js/shareSetting.js"></script>
    <script src="./js/jquery-ui.js"></script>
    
   
</head>
<body>
<!-------------------------------- topMenu Start ----------------------------------->
<header>  
    <div class="topNav">
        <a href="./index.html">
            <h1>Sunrise</h1>
        </a>

        <nav class="textMenu">
            <ul class="navList">
                <li class="navItem"><a href="./aboutus.html">關於我們</a></li>
                <li class="navItem">
                    <a href="#">花藝商品</a>
                    <ul class="productTypes">
                        <li>盆花</li>
                        <li>花束</li>
                        <li>乾燥花</li>
                        <li>
                            <a href="catalog.html">婚禮系列</a>
                        </li>
                        <li >高架花籃</li>
                    </ul>
                </li>
                <li class="navItem"><a href="faq.html">常見問題</a></li>
                <li class="navItem"><a href="contactus.html">花藝諮詢</a></li>
            </ul>
        </nav>

        <nav class="iconMenu">
            <ul>
                <li class="loginIcon"><a href="./login.html"><i class="fa-solid fa-user"></i></a></li>
                <li class="phoneMenu">
                    <i class="fa-solid fa-bars"></i>
                </li>
                <li><a class="cartIcon"><i class="fa-solid fa-cart-shopping"></i></a></li>
                <li class="valnum"><span>0</span></li>   
            </ul>
        </nav>

        <!-- 遮罩 -->
        <div class="phoneOverlay"></div>
        <!-- 漢堡bar -->
        <div class="phoneblock">
            <div class="menuCloseBlock">
                <a class="menuCloseBtn phoneMenu"><i class="fa-solid fa-arrow-left"></i></a>
                <p>CLOSE</p>
            </div>
            <ul class="phoneList">
                <li class="phoneItem"><a href="./aboutus.html">關於我們</a></li>
                <li class="phoneItem"><a href="./catalog.html">花藝商品</a></li>
                <li class="phoneItem"><a href="./faq.html">常見問題</a></li>
                <li class="phoneItem"><a href="./contactus.html">花藝諮詢</a></li>
                <li class="phoneItem login"><a href="./login.html">會員登入</a></li>
            </ul>
        </div>
    </div>

    <!-- 幻燈片... -->
    <section id="bannerSwiper" class="swiper">
        <ul class="swiper-wrapper">
            <li class="swiper-slide">
                <img src="./img/bannerN1-1440px.jpg" alt="情人節活動" class="bannerImg">
                <h1 class="ValentineTitle">情人節玫瑰，愛意盛放！</h1>
                <h1 class="ValentineTitle1">點擊選購最浪漫的禮物。</h1>
                <a href="tel:02-27120589" class="callout">點擊購買</a>
            </li>
            <li class="swiper-slide">
                <img src="./img/bannerN2-1440px.jpg" alt="母親節優惠" class="bannerImg">
                <h1 class="motherdayTitle">母親節特別優惠：</h1>
                <h1 class="motherdayTitle1">精選康乃馨花束，溫暖您心。</h1>
                <a href="tel:02-27120589" class="callout">點擊購買</a>
            </li>
        </ul>

        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </section>
</header>
<!-------------------------------- topMenu end ----------------------------------->
<!-- 遮罩 -->
<div class="webOverlay"></div>
<!-- cartslidbar -->
<section id="cartslidbarBlock">
    <div class="cartslidbarTitle">
            <a class="cartcloseBtn cartIcon"><i class="fa-solid fa-xmark"></i></a>
            <h4>購物車清單</h4>
    </div>

    <ul class="cartslidbarList">
        <!-- JS抓的資料範例 -->
        <!-- <li class="cartslidbarItem">
            <a href="#"><img src="./img/product_1.jpg" alt="新娘捧花-多彩夏季">
                <div class="cartslidbarPrice">
                    <h3>新娘捧花-多彩夏季</h3>
                    <h4>數量: 1</h4>
                    <p>NT 2,500</p>
                </div>
                <i class="fa-regular fa-trash-can slidbarDel"></i>
            </a>
        </li> -->
    </ul>
    <div style="flex-grow: 1;"></div> 

    <a href="./shopcart.html" class="gotoPayment">前往結帳</a>
</section>
<!-- ------------------購物車清單 end------------------ -->

<!-------------------------------- main ----------------------------------->    
    <main class="wrapper">

         <!-- breadcrumbNav -->
         <nav class="breadcrumbNav">
            <a href="index.html" class="breadcrumbLink">首頁</a>
            <i class="fa-solid fa-angle-right"></i>
            <a class="breadcrumbLink">花藝商品</a>
            <i class="fa-solid fa-angle-right"></i>
            <a class="breadcrumbLink">婚禮系列</a>
            <i class="fa-solid fa-angle-right"></i>
            <a href="catalog.html" class="breadcrumbLink">捧花</a>
        </nav>

        <div class="block">
            <!-- 左邊選單 -->
            <aside class="mainSidebar">
                <ul class="sidebarMenu">
                    <li class="menuTitle">花藝商品</li>
                    <li class="menuItem">盆花</li>
                    <li class="menuItem">花束</li>
                    <li class="menuItem">乾燥花</li>
                    <li id="weddingCategory">婚禮系列
                        <ul class="subMenu">
                            <li class="subItem"><a href="./catalog.html">捧花</a></li>
                            <li class="subItem">腕花</li>
                            <li class="subItem">頭冠花</li>
                        </ul>
                    </li>
                    <li class="menuItem">高架花籃</li>
                </ul>
            </aside>
        <!-- 商品 -->
            <section class="productInfo">
                
                <div class="mainImageContainer">
                    <!-- 左側商品三張小圖 -->
                        <div class="productThumbnails">
                            <ul class="thumbnailList">
                                <li class="thumbnailItem">
                                    <img src="./img/product_1_1.jpg" alt="">
                                </li>
                                <li class="thumbnailItem">
                                    <img src="./img/product_1_2.jpg" alt="">
                                </li>
                                <li class="thumbnailItem">
                                    <img src="./img/product_1_3.jpg" alt="">
                                </li>
                            </ul>
                             <!-- 商品大圖 -->
                            <figure class="flowerCard">
                                <img src="./img/product_1_1.jpg" alt="新娘捧花-多彩夏季">
                            </figure>
                        </div>
                       
                    <div class="flowerInfo">

                        <h2 class="flowerTitle">新娘捧花 多彩夏季</h2>
                        <p class="flowerPrice">NT$ 2,500</p>

                        <article class="itemSpecs">
                            <p>商品尺寸與規格單一品項非一對</p>
                            <p>高度： 約170cm up</p>
                            <p>可客制調整花材、包裝,請聯絡我們</p>
                        </article>

<!-- ------------------------- quantity & sub --------------------------- -->
                        <div class="quantityControl">

                            <button class="quantityBtn" onclick="quantityChange('sub')" aria-label="減少數量">
                                <i class="fa-solid fa-minus"></i>
                            </button>

                            <input type="text" class="quantityInput" value="1" readonly>

                            <button class="quantityBtn" onclick="quantityChange('add')" aria-label="增加數量">
                                <i class="fa-solid fa-plus"></i>
                            </button>

                        </div>
                        <!-- /*----------- price -----------*/ -->
                        <div class="price">
                            <p class="priceValue" id="subtotal"> NT$ 2,500</p>
                        </div>
                        

 <!-- ------------------------ shoppingCart & buy ---------------------- -->                       
                        <div class="cartActions cartButtonModel">
                                <a class="addToCartButton putCartIcon" data-id="1" data-name="新娘捧花-多彩夏季" data-money="2500" data-imgsrc="./img/product_1_1.jpg">
                                    <i class="fa-solid fa-cart-shopping"></i>
                                    加入購物車
                                </a>
                                <a class="buyNowButton" data-id="1" data-name="新娘捧花-多彩夏季" data-money="2500" data-imgsrc="./img/product_1_1.jpg" onclick="buyNow(this)">
                                    <i class="fa-solid fa-bag-shopping"></i>
                                    直接購買
                                </a>
                        </div>
                    </div>
                </div>

 
 <!-- ------------------------ attentionItems ---------------------- -->   
                <div class="productNotes">
                    <div class="bottomLine">
                        <div class="textOutline">
                            <h4>注意事項</h4>
                        </div>
                    </div>
                    <ul class="attentionInfo">
                        <li>商品皆為手工製作，尺寸及花況可能略有誤差，以實際商品為主，煩請見諒。</li>
                        <li>若遇花材缺貨，將會以其他等值的花材或顏色設計調整。</li>
                        <li>商品實際顏色可能因電腦、手機螢幕顯示略有落差。</li>
                    </ul>
                    
<!-- ----------- similarProduct ----------- -->
                    <section class="similarProduct">
                        <h4 class="similarTitle">相關商品</h4>   
                        <ul class="scrollImg">
                            <li>
                                <a href="#">
                                    <img src="./img/product_2.jpg" alt="新娘捧花-夕陽柔情" class="productImg">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="./img/product_3.jpg" alt="新娘捧花-粉色花漾" class="productImg">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="./img/product_4.jpg" alt="新娘捧花-綠意盎然" class="productImg">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="./img/product_5.jpg" alt="新娘捧花-夢幻藍調" class="productImg">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="./img/product_6.jpg" alt="新娘捧花-金霞绽放" class="productImg">
                                </a>
                            </li>
                        </ul>
                    </section>
                </div>
            </section>
        </div>
<!-- ------------------------ recentlyView ---------------------- -->  

        <div class="recentlyView">
            <button>最近 <br> 瀏覽</button>
            <ul class="historyList">
                <li class="historyItem">
                    <a href="product.html">
                        <img src="./img/product_2.jpg" alt="新娘捧花-繽紛花園">
                    </a>
                </li>
                <li class="historyItem">
                    <a href="#">
                        <img src="./img/product_1_1.jpg" alt="新娘捧花-繽紛花園">
                    </a>
                </li>
            </ul>
        </div>
    </main>


<!---------------------------------- footer -------------------------------->

<footer>
    <div class="copyRight">
        <span class="footerInfo">Copyright© 本網站為緯育TibaMe【第91期】前端工程師專業技術養成班學員作品,僅供學習、展示之用途。</span>
        <span class="socialLink">
            <a href="#"><i class="fa-brands fa-square-facebook"></i></a>
            <a href="#"><i class="fa-brands fa-instagram"></i></a>
            <a href="#"><i class="fa-brands fa-line"></i></a>
        </span>
    </div>
</footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let weddingCategory = document.getElementById("weddingCategory");
            let subMenu = weddingCategory.querySelector(".subMenu");
        
            weddingCategory.addEventListener("click", function(event) {
                event.preventDefault();
                subMenu.style.display = (subMenu.style.display === 'none' || subMenu.style.display === '') ? 'block' : 'none';
            });
        
            let subItems = document.querySelectorAll(".subItem");
            subItems.forEach(function(item) {
                item.addEventListener("click", function(event) {
                    if (item.textContent.trim() === "捧花") {
                        event.stopPropagation();
                        return;
                    }
                    event.preventDefault();
                });
            });
        });

        displayCartItems();

        function quantityChange(mathematics) {
                
            let quantityInput = document.querySelector('.quantityInput');
            let priceValue = document.querySelector('.priceValue');

            let flowerPrice = 2500;
            let currentSubtotal = parseInt(priceValue.innerText.replace('小計：NT$ ', '').replace(/,/g, ''));
            
            // 抓quantityInput的值
            let currentValue = parseInt(quantityInput.value);

            // 根據HTML傳回來的參數帶進 mathematics 進行增加或减少
            if (mathematics === 'add') {
                currentValue += 1;
            } else if (mathematics === 'sub') {
                currentValue -= 1;
                
                if (currentValue < 1) {
                    currentValue = 1;
                }
            }

            let newSubtotal = currentValue * flowerPrice;
            // 更新 quantityInput 的值
            quantityInput.value = currentValue;

            priceValue.innerText = '小計：NT$ ' + newSubtotal.toLocaleString();
        }

        function buyNow(element){

            let quantityInput = document.querySelector('.quantityInput');
            let count = quantityInput ? parseInt(quantityInput.value) : 1;

            let productCard = {
                "id" : $(element).data('id'),
                "name": $(element).data('name'),
                "imgUrl" : $(element).data('imgsrc'),
                "price": $(element).data('money'),
                "count" : count,
            }
            
            let existCart = localStorage.getItem('productCards');

            if(existCart){
                // 將購物車資料轉換為JavaScript物件陣列
                let storedCartItemsJson = JSON.parse(existCart);

                let existingProductIndex = storedCartItemsJson.findIndex(item => item.id === productCard.id);
                if(existingProductIndex !== -1){
                    // 如果購物車中已有相同的商品，增加其数量
                    storedCartItemsJson[existingProductIndex].count += count;

                    console.log(storedCartItemsJson[existingProductIndex].count);
                    // storedCartItemsJson.push(productCard);
                    localStorage.setItem('productCards', JSON.stringify(storedCartItemsJson));
                    // 抓數量和價錢
                    $('.cartslidbarList').find('.cartslidbarItem').each(function(){
                        let itemId = $(this).data('id');
                        if (itemId === storedCartItemsJson[existingProductIndex].id) {
                        let updateCount =  storedCartItemsJson[existingProductIndex].count;
                        let updatePrice =  storedCartItemsJson[existingProductIndex].price;
                        total = updateCount * updatePrice;
                        let formattedTotal = total.toLocaleString();
                            $(this).find('.cartslidbarPrice p').text('NT:' + formattedTotal);
                            $(this).find('.cartslidbarPrice h4').text('數量：' + updateCount)
                        }
                        // console.log(itemId);
                    })
                } else {
                    // 如果購物車沒有東西就新增一個蓋過去
                    storedCartItemsJson.push(productCard);
                    localStorage.setItem('productCards', JSON.stringify(storedCartItemsJson));
                }

            }else{
                // 將購物車資料轉換為JSON格式的字串
                let cartItemsString = JSON.stringify([productCard]);
                // console.log('cartItemsJson:'+cartItemsJson);
                localStorage.setItem('productCards', cartItemsString);
                // => var productCards = cartItemsString;
            }
            window.location.href = 'shopcart.html';
        }
    </script>


</body>
</html>